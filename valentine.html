<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Will You Be My Valentine? ðŸ’•</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Arial", sans-serif;
        background: linear-gradient(
          135deg,
          #ffeef8 0%,
          #ffe0f0 50%,
          #ffd4e5 100%
        );
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        overflow: hidden;
        position: relative;
      }

      /* Floating hearts background */
      .heart-bg {
        position: absolute;
        width: 100%;
        height: 100%;
        pointer-events: none;
        overflow: hidden;
      }

      .floating-heart {
        position: absolute;
        font-size: 20px;
        animation: float 6s infinite ease-in-out;
        opacity: 0.3;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0) rotate(0deg);
        }
        50% {
          transform: translateY(-20px) rotate(10deg);
        }
      }

      /* Mobile message */
      .mobile-message {
        display: none;
        text-align: center;
        padding: 40px;
        background: white;
        border-radius: 20px;
        box-shadow: 0 10px 40px rgba(255, 105, 180, 0.3);
        max-width: 90%;
      }

      .mobile-message h2 {
        color: #ff69b4;
        margin-bottom: 20px;
        font-size: 24px;
      }

      .mobile-message p {
        color: #666;
        font-size: 16px;
      }

      /* Envelope container */
      .envelope-container {
        position: relative;
        cursor: pointer;
        transition: transform 0.3s ease;
      }

      .envelope-container:hover {
        transform: scale(1.05);
      }

      .envelope-wrapper {
        position: relative;
        width: 300px;
        height: 200px;
      }

      .envelope {
        position: relative;
        width: 100%;
        height: 100%;
      }

      .envelope-back {
        position: absolute;
        width: 300px;
        height: 200px;
        background: #ff69b4;
        border-radius: 10px;
        box-shadow: 0 10px 40px rgba(255, 105, 180, 0.5);
      }

      .envelope-flap {
        position: absolute;
        top: 0;
        left: 0;
        width: 0;
        height: 0;
        border-left: 150px solid transparent;
        border-right: 150px solid transparent;
        border-top: 100px solid #ff1493;
        transform-origin: top center;
        transition: transform 0.8s ease;
        z-index: 3;
      }

      .envelope-flap.open {
        transform: rotateX(180deg);
      }

      .click-hint {
        position: absolute;
        top: -60px;
        left: 50%;
        transform: translateX(-50%);
        color: #ff1493;
        font-size: 18px;
        font-weight: bold;
        animation: bounce 1s infinite;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateX(-50%) translateY(0);
        }
        50% {
          transform: translateX(-50%) translateY(-10px);
        }
      }

      /* Card content - now with canvas */
      .card-content {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.5s ease;
        z-index: 2;
      }

      .card-content.show {
        opacity: 1;
        pointer-events: all;
      }

      #cardCanvas {
        display: block;
      }

      /* Celebration */
      .celebration {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.95);
        z-index: 1000;
        justify-content: center;
        align-items: center;
        overflow: hidden;
      }

      .celebration.show {
        display: flex;
      }

      /* Scrolling rows background */
      .celebration-rows {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        z-index: 1;
        overflow: hidden;
      }

      .celebration-row {
        width: 100%;
        height: 20%;
        overflow: hidden;
        display: flex;
        align-items: center;
        position: relative;
      }

      .celebration-scroll {
        display: flex;
        gap: 20px;
        transform: translateZ(0);
        will-change: transform;
        backface-visibility: hidden;
        position: absolute;
      }

      .celebration-item {
        height: calc(20vh * 0.8);
        width: calc(20vh * 0.8);
        background: rgba(255, 255, 255, 0.1);
        border-radius: 20px;
        border: 3px solid #ff69b4;
        flex-shrink: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        box-shadow: 0 0 15px rgba(255, 105, 180, 0.4);
      }

      .celebration-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .celebration-content {
        text-align: center;
        position: relative;
        z-index: 2;
        background: rgba(255, 255, 255, 0.9);
        padding: 40px;
        border-radius: 30px;
        box-shadow: 0 10px 50px rgba(255, 105, 180, 0.3);
      }

      @keyframes zoomIn {
        from {
          transform: scale(0);
        }
        to {
          transform: scale(1);
        }
      }

      .celebration-content h1 {
        color: #ff1493;
        font-size: 48px;
        margin-bottom: 20px;
        animation: pulse 1s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.05);
        }
      }

      .photo-placeholder {
        width: 300px;
        height: 300px;
        background: linear-gradient(135deg, #ffeef8, #ffe0f0);
        border: 5px solid #ff69b4;
        border-radius: 20px;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 30px auto;
        color: #ff69b4;
        font-size: 20px;
        overflow: hidden;
        position: relative;
      }

      .photo-placeholder img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        display: block;
      }

      .photo-placeholder-text {
        position: absolute;
        pointer-events: none;
      }

      .confetti {
        position: absolute;
        width: 10px;
        height: 10px;
        top: -20px;
      }

      @keyframes confetti-fall {
        to {
          transform: translateY(110vh) rotate(720deg);
          opacity: 0;
        }
      }

      @keyframes confetti-sway {
        0%,
        100% {
          transform: translateX(0);
        }
        50% {
          transform: translateX(100px);
        }
      }

      .hidden {
        display: none !important;
      }
    </style>
  </head>
  <body>
    <!-- Floating hearts background -->
    <div class="heart-bg" id="heartBg"></div>

    <!-- Mobile message -->
    <div class="mobile-message" id="mobileMessage">
      <h2>ðŸ’• Please Open on Desktop ðŸ’•</h2>
      <p>
        For the best experience with this Valentine's card, please open it in a
        desktop browser!
      </p>
    </div>

    <!-- Main content -->
    <div id="mainContent">
      <!-- Envelope -->
      <div class="envelope-container" id="envelopeContainer">
        <div class="click-hint">ðŸ‘† Click me! ðŸ’•</div>
        <div class="envelope-wrapper">
          <div class="envelope">
            <div class="envelope-back"></div>
            <div class="envelope-flap" id="envelopeFlap"></div>
          </div>
        </div>
      </div>

      <!-- Card content with canvas -->
      <div class="card-content" id="cardContent">
        <canvas id="cardCanvas"></canvas>
      </div>
    </div>

    <!-- Celebration -->
    <div class="celebration" id="celebration">
      <!-- Scrolling rows background -->
      <div class="celebration-rows" id="celebrationRows"></div>

      <!-- Content on top -->
      <div class="celebration-content">
        <h1>Pookie is my Valentine ðŸ’•ðŸ’–ðŸ’•</h1>
        <div class="photo-placeholder">
          <img id="celebrationPhoto" src="IMG_8453.jpg" alt="" />
        </div>
        <p style="font-size: 24px; color: #ff1493">I'm so happy! ðŸ’–</p>
      </div>
    </div>

    <script>
      // Check if mobile/tablet
      function isMobileOrTablet() {
        return window.innerWidth <= 1024;
      }

      // Show appropriate content based on device
      function checkDevice() {
        const mobileMessage = document.getElementById("mobileMessage");
        const mainContent = document.getElementById("mainContent");

        if (isMobileOrTablet()) {
          mobileMessage.style.display = "block";
          mainContent.style.display = "none";
        } else {
          mobileMessage.style.display = "none";
          mainContent.style.display = "block";
        }
      }

      // Create floating hearts
      function createFloatingHearts() {
        const heartBg = document.getElementById("heartBg");
        for (let i = 0; i < 15; i++) {
          const heart = document.createElement("div");
          heart.className = "floating-heart";
          heart.textContent = "ðŸ’•";
          heart.style.left = Math.random() * 100 + "%";
          heart.style.top = Math.random() * 100 + "%";
          heart.style.animationDelay = Math.random() * 3 + "s";
          heartBg.appendChild(heart);
        }
      }

      // Envelope click handler
      const envelopeContainer = document.getElementById("envelopeContainer");
      const envelopeFlap = document.getElementById("envelopeFlap");
      const cardContent = document.getElementById("cardContent");

      envelopeContainer.addEventListener("click", function () {
        envelopeFlap.classList.add("open");
        setTimeout(() => {
          envelopeContainer.style.display = "none";
          cardContent.classList.add("show");
          startCardAnimation();
        }, 800);
      });

      // Canvas-based card with animated buttons
      const canvas = document.getElementById("cardCanvas");
      const ctx = canvas.getContext("2d");

      // Set canvas size
      canvas.width = 500;
      canvas.height = 400;

      // Button class
      class Button {
        constructor(x, y, width, height, text, color, textColor) {
          this.x = x;
          this.y = y;
          this.targetX = x;
          this.targetY = y;
          this.width = width;
          this.height = height;
          this.text = text;
          this.color = color;
          this.textColor = textColor;
          this.hovered = false;
          this.scale = 1;
          this.targetScale = 1;
        }

        update() {
          // Smooth movement animation
          this.x += (this.targetX - this.x) * 0.2;
          this.y += (this.targetY - this.y) * 0.2;

          // Smooth scale animation
          this.scale += (this.targetScale - this.scale) * 0.2;
        }

        draw(ctx) {
          ctx.save();

          // Apply scale from center
          const centerX = this.x + this.width / 2;
          const centerY = this.y + this.height / 2;
          ctx.translate(centerX, centerY);
          ctx.scale(this.scale, this.scale);
          ctx.translate(-centerX, -centerY);

          // Draw button
          ctx.fillStyle = this.color;
          ctx.shadowColor = "rgba(0, 0, 0, 0.2)";
          ctx.shadowBlur = 10;
          ctx.shadowOffsetY = 5;

          // Rounded rectangle
          const radius = 25;
          ctx.beginPath();
          ctx.moveTo(this.x + radius, this.y);
          ctx.lineTo(this.x + this.width - radius, this.y);
          ctx.quadraticCurveTo(
            this.x + this.width,
            this.y,
            this.x + this.width,
            this.y + radius,
          );
          ctx.lineTo(this.x + this.width, this.y + this.height - radius);
          ctx.quadraticCurveTo(
            this.x + this.width,
            this.y + this.height,
            this.x + this.width - radius,
            this.y + this.height,
          );
          ctx.lineTo(this.x + radius, this.y + this.height);
          ctx.quadraticCurveTo(
            this.x,
            this.y + this.height,
            this.x,
            this.y + this.height - radius,
          );
          ctx.lineTo(this.x, this.y + radius);
          ctx.quadraticCurveTo(this.x, this.y, this.x + radius, this.y);
          ctx.closePath();
          ctx.fill();

          // Draw text
          ctx.shadowColor = "transparent";
          ctx.fillStyle = this.textColor;
          ctx.font = "bold 20px Arial";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(
            this.text,
            this.x + this.width / 2,
            this.y + this.height / 2,
          );

          ctx.restore();
        }

        contains(x, y) {
          return (
            x >= this.x &&
            x <= this.x + this.width &&
            y >= this.y &&
            y <= this.y + this.height
          );
        }

        getCenter() {
          return {
            x: this.x + this.width / 2,
            y: this.y + this.height / 2,
          };
        }
      }

      // Create buttons
      const yesButton = new Button(
        100,
        280,
        120,
        60,
        "Yes! ðŸ’–",
        "#ff1493",
        "white",
      );
      const noButton = new Button(280, 280, 120, 60, "No", "#ddd", "#666");

      const safeDistance = 120;
      let mouseX = 0;
      let mouseY = 0;
      let animationId = null;

      // Get mouse position relative to canvas
      canvas.addEventListener("mousemove", function (e) {
        const rect = canvas.getBoundingClientRect();
        mouseX = e.clientX - rect.left;
        mouseY = e.clientY - rect.top;
      });

      // Handle clicks
      canvas.addEventListener("click", function (e) {
        const rect = canvas.getBoundingClientRect();
        const clickX = e.clientX - rect.left;
        const clickY = e.clientY - rect.top;

        if (yesButton.contains(clickX, clickY)) {
          showCelebration();
        }
      });

      function animate() {
        // Clear canvas
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // Draw card background
        ctx.fillStyle = "white";
        ctx.shadowColor = "rgba(255, 105, 180, 0.3)";
        ctx.shadowBlur = 40;
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.shadowColor = "transparent";

        // Draw title with heartbeat animation
        const time = Date.now() / 1000;
        const heartbeatScale = 1 + Math.sin(time * 2) * 0.05;

        ctx.save();
        ctx.translate(canvas.width / 2, 100);
        ctx.scale(heartbeatScale, heartbeatScale);
        ctx.fillStyle = "#ff1493";
        ctx.font = "bold 32px Arial";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("Kaitlyn,", 0, -40);
        ctx.fillText("will you be my", 0, 0);
        ctx.fillText("Valentine? ðŸ’•", 0, 40);
        ctx.restore();

        // Calculate distance from mouse to no button
        const noCenter = noButton.getCenter();
        const dx = noCenter.x - mouseX;
        const dy = noCenter.y - mouseY;
        const distance = Math.sqrt(dx * dx + dy * dy);

        // Move no button away if mouse is too close
        if (distance < safeDistance) {
          const angle = Math.atan2(dy, dx);
          const moveDistance = 150;

          let newX =
            noCenter.x + Math.cos(angle) * moveDistance - noButton.width / 2;
          let newY =
            noCenter.y + Math.sin(angle) * moveDistance - noButton.height / 2;

          // Keep within canvas bounds
          const padding = 20;
          newX = Math.max(
            padding,
            Math.min(canvas.width - noButton.width - padding, newX),
          );
          newY = Math.max(
            padding,
            Math.min(canvas.height - noButton.height - padding, newY),
          );

          noButton.targetX = newX;
          noButton.targetY = newY;
        }

        // Check if yes button is hovered
        if (yesButton.contains(mouseX, mouseY)) {
          yesButton.targetScale = 1.1;
          canvas.style.cursor = "pointer";
        } else {
          yesButton.targetScale = 1;
          canvas.style.cursor = "default";
        }

        // Update and draw buttons
        yesButton.update();
        noButton.update();
        yesButton.draw(ctx);
        noButton.draw(ctx);

        animationId = requestAnimationFrame(animate);
      }

      function startCardAnimation() {
        animate();
      }

      // Celebration
      const celebration = document.getElementById("celebration");

      function showCelebration() {
        cancelAnimationFrame(animationId);
        celebration.classList.add("show");
        createConfetti();
        createScrollingRows();
      }

      // Create scrolling photo rows with optimized rendering
      function createScrollingRows() {
        const celebrationRows = document.getElementById("celebrationRows");
        const rowCount = 5;
        const itemsPerRow = 15; // Reduced from 15

        const images = celebrationImages;
        const rowsData = [];

        for (let i = 0; i < rowCount; i++) {
          const row = document.createElement("div");
          row.className = "celebration-row";

          const scrollContainer = document.createElement("div");
          scrollContainer.className = "celebration-scroll";

          let lastImageIndex = -1;

          // Create items (doubled for seamless loop)
          for (let j = 0; j < itemsPerRow * 2; j++) {
            const item = document.createElement("div");
            item.className = "celebration-item";

            const img = document.createElement("img");
            img.alt = "Memory";
            img.loading = "lazy"; // Use lazy loading

            // Get a random image that's different from the last one
            let imageIndex;
            do {
              imageIndex = Math.floor(Math.random() * images.length);
            } while (imageIndex === lastImageIndex && images.length > 1);

            img.src = images[imageIndex];
            lastImageIndex = imageIndex;

            item.appendChild(img);
            scrollContainer.appendChild(item);
          }

          row.appendChild(scrollContainer);
          celebrationRows.appendChild(row);

          // Store row data for animation
          const direction = i % 2 === 0 ? -1 : 1;
          const rowData = {
            element: scrollContainer,
            position: 0,
            direction: direction,
            speed: direction * 1.5,
            maxWidth: 0,
          };
          rowsData.push(rowData);

          // Calculate max width
          requestAnimationFrame(() => {
            rowData.maxWidth = scrollContainer.scrollWidth / 2;
            rowData.position = -Math.random() * rowData.maxWidth;
          });
        }

        // Optimized animation with throttling
        let lastFrameTime = 0;
        const frameInterval = 1000 / 60; // Target 60fps

        function animateRows(currentTime) {
          if (currentTime - lastFrameTime < frameInterval) {
            if (celebration.classList.contains("show")) {
              requestAnimationFrame(animateRows);
            }
            return;
          }

          lastFrameTime = currentTime;

          rowsData.forEach((rowData) => {
            if (rowData.maxWidth === 0) return;

            rowData.position += rowData.speed * 0.5;

            const halfWidth = rowData.maxWidth;
            while (rowData.position < -halfWidth) {
              rowData.position += halfWidth;
            }
            while (rowData.position > 0) {
              rowData.position -= halfWidth;
            }

            const smoothPosition = Math.round(rowData.position * 10) / 10;
            rowData.element.style.transform = `translate3d(${smoothPosition}px, 0, 0)`;
          });

          if (celebration.classList.contains("show")) {
            requestAnimationFrame(animateRows);
          }
        }

        requestAnimationFrame(animateRows);
      }

      // Create confetti
      function createConfetti() {
        const colors = [
          "#ff69b4",
          "#ff1493",
          "#ffc0cb",
          "#ff85c1",
          "#ff4da6",
          "#ffb6c1",
          "#ff85a1",
        ];
        const shapes = ["circle", "square", "triangle"];

        for (let i = 0; i < 150; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti";
          confetti.style.left = Math.random() * 100 + "%";
          confetti.style.width = Math.random() * 10 + 5 + "px";
          confetti.style.height = Math.random() * 10 + 5 + "px";
          confetti.style.background =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.opacity = Math.random() * 0.7 + 0.3;
          confetti.style.animationDelay = Math.random() * 2 + "s";
          confetti.style.animationDuration = Math.random() * 2 + 3 + "s";

          // Random shape
          const shape = shapes[Math.floor(Math.random() * shapes.length)];
          if (shape === "circle") {
            confetti.style.borderRadius = "50%";
          } else if (shape === "triangle") {
            confetti.style.clipPath = "polygon(50% 0%, 0% 100%, 100% 100%)";
          } else {
            confetti.style.transform = "rotate(" + Math.random() * 360 + "deg)";
          }

          confetti.style.animation = `confetti-fall ${confetti.style.animationDuration} linear ${confetti.style.animationDelay} forwards`;

          celebration.appendChild(confetti);
        }
      }

      // Optimized lazy image loading
      const imageCache = new Map();
      let imagesLoaded = 0;

      function preloadImagesProgressively(images, callback) {
        const batchSize = 3; // Load 3 at a time
        let currentBatch = 0;

        function loadBatch() {
          const start = currentBatch * batchSize;
          const end = Math.min(start + batchSize, images.length);
          const batch = images.slice(start, end);

          let batchLoaded = 0;

          batch.forEach((src) => {
            const img = new Image();
            img.onload = () => {
              imageCache.set(src, img);
              imagesLoaded++;
              batchLoaded++;

              if (batchLoaded === batch.length) {
                currentBatch++;
                if (currentBatch * batchSize < images.length) {
                  loadBatch();
                } else if (callback) {
                  callback();
                }
              }
            };
            img.onerror = () => {
              batchLoaded++;
              if (batchLoaded === batch.length) {
                currentBatch++;
                if (currentBatch * batchSize < images.length) {
                  loadBatch();
                } else if (callback) {
                  callback();
                }
              }
            };
            img.src = src;
          });
        }

        loadBatch();
      }

      const celebrationImages = [
        "IMG_9611.jpg",
        "IMG_9595.jpg",
        "IMG_9483.jpg",
        "IMG_9300.jpg",
        "IMG_9293.jpg",
        "IMG_9040.jpg",
        "IMG_8929.jpg",
        "IMG_8928.jpg",
        "IMG_8880.jpg",
        "IMG_8876.jpg",
        "IMG_8875.jpg",
        "IMG_8870.jpg",
        "IMG_8522.jpg",
        "IMG_8508.jpg",
        "IMG_8455.jpg",
        "IMG_8453.jpg",
        "IMG_8447.jpg",
        "IMG_8395.jpg",
        "IMG_8369.jpg",
        "IMG_8358.JPEG",
        "IMG_0192.JPG",
      ];

      // Start preloading when page loads
      preloadImagesProgressively(celebrationImages);

      // Initialize
      checkDevice();
      createFloatingHearts();
      window.addEventListener("resize", checkDevice);
    </script>
  </body>
</html>
